<!--<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="ISO-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Arkisto</title>
</head>

<body>
    <div>
        <div id="uusimmat">
            <div id="uusin1">
                <p id="uusin1otsikko"></p>
                <p id="uusin1aika"></p>
                <p id="uusin1sisalto"></p>
                <a id="uusin1linkki" href=""></a>
            </div>
            <div id="uusin2">
                <p id="uusin2otsikko"></p>
                <p id="uusin2aika"></p>
                <p id="uusin2sisalto"></p>
                <a id="uusin2linkki" href=""></a>
            </div>
            <div id="uusin3">
                <p id="uusin3otsikko"></p>
                <p id="uusin3aika"></p>
                <p id="uusin3sisalto"></p>
                <a id="uusin3linkki" href=""></a>
            </div>
            <div id="uusin4">
                <p id="uusin4otsikko"></p>
                <p id="uusin4aika"></p>
                <p id="uusin4sisalto"></p>
                <a id="uusin4linkki" href=""></a>
            </div>
            <div id="uusin5">
                <p id="uusin5otsikko"></p>
                <p id="uusin5aika"></p>
                <p id="uusin5sisalto"></p>
                <a id="uusin5linkki" href=""></a>
            </div>
            <div id="uusin6">
                <p id="uusin6otsikko"></p>
                <p id="uusin6aika"></p>
                <p id="uusin6sisalto"></p>
                <a id="uusin6linkki" href=""></a>
            </div> 
            <div id="uusin7">
                <p id="uusin7otsikko"></p>
                <p id="uusin7aika"></p>
                <p id="uusin7sisalto"></p>
                <a id="uusin7linkki" href=""></a>
            </div>
            <div id="uusin8">
                <p id="uusin8otsikko"></p>
                <p id="uusin8aika"></p>
                <p id="uusin8sisalto"></p>
                <a id="uusin8linkki" href=""></a>
            </div>
            <div id="uusin9">
                <p id="uusin9otsikko"></p>
                <p id="uusin9aika"></p>
                <p id="uusin9sisalto"></p>
                <a id="uusin9linkki" href=""></a>
            </div>
            <div id="uusin10">
                <p id="uusin10otsikko"></p>
                <p id="uusin10aika"></p>
                <p id="uusin10sisalto"></p>
                <a id="uusin10linkki" href=""></a>
            </div>
        </div>
    </div>
    <div id="linkit">
        <a id="linkki1" href="http://localhost/blogitehtava/index.php?sivu=1">1</a>
        <a id="linkki2" href="http://localhost/blogitehtava/index.php?sivu=2">2</a>
        <a id="linkki3" href="http://localhost/blogitehtava/index.php?sivu=3">3</a>
        <a id="linkki4" href="http://localhost/blogitehtava/index.php?sivu=4">4</a>
        <a id="linkki5" href="http://localhost/blogitehtava/index.php?sivu=5">5</a>
        <a id="linkki6" href="http://localhost/blogitehtava/index.php?sivu=6">6</a>
        <a id="linkki7" href="http://localhost/blogitehtava/index.php?sivu=7">7</a>
        <a id="linkki8" href="http://localhost/blogitehtava/index.php?sivu=8">8</a>
        <a id="linkki9" href="http://localhost/blogitehtava/index.php?sivu=9">9</a>
        <a id="linkki10" href="http://localhost/blogitehtava/index.php?sivu=10">10</a>
    </div>
</body>

</html>-->
<?php
$html_string = '<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="ISO-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Arkisto</title>
</head>

<body>
    <div>
        <div id="uusimmat">
            <div id="uusin1">
                <p id="uusin1otsikko"></p>
                <p id="uusin1aika"></p>
                <p id="uusin1sisalto"></p>
                <a id="uusin1linkki" href=""></a>
            </div>
            <div id="uusin2">
                <p id="uusin2otsikko"></p>
                <p id="uusin2aika"></p>
                <p id="uusin2sisalto"></p>
                <a id="uusin2linkki" href=""></a>
            </div>
            <div id="uusin3">
                <p id="uusin3otsikko"></p>
                <p id="uusin3aika"></p>
                <p id="uusin3sisalto"></p>
                <a id="uusin3linkki" href=""></a>
            </div>
            <div id="uusin4">
                <p id="uusin4otsikko"></p>
                <p id="uusin4aika"></p>
                <p id="uusin4sisalto"></p>
                <a id="uusin4linkki" href=""></a>
            </div>
            <div id="uusin5">
                <p id="uusin5otsikko"></p>
                <p id="uusin5aika"></p>
                <p id="uusin5sisalto"></p>
                <a id="uusin5linkki" href=""></a>
            </div>
            <div id="uusin6">
                <p id="uusin6otsikko"></p>
                <p id="uusin6aika"></p>
                <p id="uusin6sisalto"></p>
                <a id="uusin6linkki" href=""></a>
            </div>
            <div id="uusin7">
                <p id="uusin7otsikko"></p>
                <p id="uusin7aika"></p>
                <p id="uusin7sisalto"></p>
                <a id="uusin7linkki" href=""></a>
            </div>
            <div id="uusin8">
                <p id="uusin8otsikko"></p>
                <p id="uusin8aika"></p>
                <p id="uusin8sisalto"></p>
                <a id="uusin8linkki" href=""></a>
            </div>
            <div id="uusin9">
                <p id="uusin9otsikko"></p>
                <p id="uusin9aika"></p>
                <p id="uusin9sisalto"></p>
                <a id="uusin9linkki" href=""></a>
            </div>
            <div id="uusin10">
                <p id="uusin10otsikko"></p>
                <p id="uusin10aika"></p>
                <p id="uusin10sisalto"></p>
                <a id="uusin10linkki" href=""></a>
            </div>
        </div>
    </div>
    <div id="linkit">
    </div>
</body>

</html>';
$dom = new DOMDocument();
@$dom->loadHTML($html_string);
$uusimmatElement =$dom->getElementById("uusimmat");
$linkitElement = $dom->getElementById("linkit");
$listaMaara = 10;

$queryString = parse_url($_SERVER['REQUEST_URI'], PHP_URL_QUERY);
$params = [];
$sivu = 1;
if($queryString) {
parse_str($queryString, $params);
$sivu = (int) $params['sivu'];
}

$servername = "localhost";
$username = "esimerkki";
$password = "ikkremise";
$dbname = "localhost";


$conn = new mysqli($servername, $username, $password, $dbname);
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$sql = "SELECT id, aika, otsikko, sisalto, kirjoittaja FROM artikkelit2
            ORDER BY aika DESC
            LIMIT " . $listaMaara . " OFFSET " . $listaMaara*$sivu-$listaMaara . "";
$result = $conn->query($sql);
$all_rows = mysqli_fetch_all($result, MYSQLI_ASSOC);
//var_dump($result);
for($x = 1; $x < count($all_rows) + 1; $x++) {
    $uusinDiv = $dom->createElement('div');
    $uusinDiv->setAttribute("id", "uusin$x");
    $uusimmatElement->appendChild($uusinDiv);
    $uusinOtskko = $dom->createElement('p');
    $uusinOtskko->setAttribute("id", "uusin" . $x . "otsikko");
    $uusinAika = $dom->createElement('p');
    $uusinAika->setAttribute("id", "uusin" . $x . "aika");
    $uusinSisalto = $dom->createElement('p');
    $uusinSisalto->setAttribute("id", "uusin" . $x . "sisalto");
    $uusinLinkki = $dom->createElement('a');
    $uusinLinkki->setAttribute("id", "uusin" . $x . "linkki");
    $uusinDiv->appendChild($uusinOtskko);
    $uusinDiv->appendChild($uusinAika);
    $uusinDiv->appendChild($uusinSisalto);
    $uusinDiv->appendChild($uusinLinkki);

    $index = $x-1;
    $row = $all_rows[$index];
    $uusinOtskko->textContent = $row["otsikko"];
    $uusinAika->nodeValue = $row["aika"];
    $uusinSisalto->nodeValue = substr($row["sisalto"], 0, 120) . "...";
    $uusinLinkki->nodeValue = "Lue lisää";
    //$linkkiElement->attributes["href"]->value = "http://localhost/blogitehtava/artikkeli.php?q=" . (string) $row["id"] . '&index=' . $index . '';
    $uusinLinkki->setAttribute(
    'href',
    'http://localhost/blogitehtava/artikkeli.php?' . http_build_query(['id' => (string)$row['id']])
);
    /*$otsikkoElement->textContent = $row["otsikko"];
    $aikaElement->nodeValue = $row["aika"];
    $sisaltoElement->nodeValue = substr($row["sisalto"], 0, 120) . "...";
    $linkkiElement->nodeValue = "Lue lisää";
    //$linkkiElement->attributes["href"]->value = "http://localhost/blogitehtava/artikkeli.php?q=" . (string) $row["id"] . '&index=' . $index . '';
    $linkkiElement->setAttribute(
    'href',
    'http://localhost/blogitehtava/artikkeli.php?' . http_build_query(['id' => (string)$row['id']])
);*/
    //$uusimmatElement->textContent = $row["otsikko"] . " " . $row["aika"] . "<br>" . substr($row["sisalto"], 0, 120) . "...<br>" . "<a href='http://localhost/blogitehtava/artikkeli.php?q=" . (string) $row["id"] . "'>Lue lisää</a>" . "<br>";
}
//var_dump($linkkiElement);
/*while ($row = $result->fetch_assoc()) {
    //echo $row["otsikko"] . " " . $row["aika"] . "<br>" . substr($row["sisalto"], 0, 120) . "...<br>" . "<a href='http://localhost/blogitehtava/artikkeli.php?q=" . (string) $row["id"] . "'>Lue lisää</a>" . "<br>";
}*/
$sql = "SELECT COUNT(*) FROM artikkelit2";
$result = $conn->query($sql);
$taulunPituus = mysqli_fetch_all($result, MYSQLI_ASSOC)[0]['COUNT(*)'];
$y = 0;
for($x = $taulunPituus; $x > 0; $x-=$listaMaara) {
    $y++;
    $uusiLinkkiElement = $dom->createElement('a');
    $uusiLinkkiElement->setAttribute("id", "linkki$y");
    $uusiLinkkiElement->setAttribute("href", "http://localhost/blogitehtava/index.php?sivu=$y");
    $uusiLinkkiElement->textContent = "$y";
    $linkitElement->appendChild($uusiLinkkiElement);
}
$nykyinenLinkki = $dom->getElementById("linkki" . $sivu);
$nykyinenLinkki->removeAttribute("href");
$nykyinenLinkki->className = "bold";
echo $dom->saveHTML();
?>